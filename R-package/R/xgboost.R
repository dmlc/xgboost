#' eXtreme Gradient Boosting (Tree) library
#' 
#' A simple interface for xgboost in R
#' 
#' @param data takes \code{matrix}, \code{dgCMatrix}, local data file or 
#'   \code{xgb.DMatrix}. 
#' @param label the response variable. Not required if data is local data file 
#'   or \code{xgb.DMatrix}. 
#' @param params the list of parameters. See 
#'   \url{https://github.com/tqchen/xgboost/wiki/Parameters} for 
#'   further details.
#' @param nrounds the max number of iterations
#' @param verbose If 0, xgboost will stay silent. If 1, xgboost will print 
#'   information of performance. If 2, xgboost will print information of both
#'   performance and tree.
#' @param ... other parameters to pass to \code{params}.
#' 
#' @details 
#' This is the modeling function for xgboost.
#' 
#' Parallelization is automatically enabled under Linux/Windows. Mac users can 
#' also enjoy this feature if compile this package with openmp.
#' 
#' @section Value
#' return a \code{xgb.DMatrix} class object.
#' 
#' @examples
#' data(iris)
#' bst <- xgboost(as.matrix(iris[,1:4]),as.numeric(iris[,5]), nrounds = 2)
#' pred <- predict(bst, as.matrix(iris[,1:4]))
#' 
xgboost <- function(data = NULL, label = NULL, params = list(), nrounds, 
                    verbose = 1, ...) {
  inClass <- class(data)
  if (inClass == "dgCMatrix" || inClass == "matrix") {
    if (is.null(label)) 
      stop("xgboost: need label when data is a matrix")
    dtrain <- xgb.DMatrix(data, label = label)
  } else {
    if (!is.null(label)) 
      warning("xgboost: label will be ignored.")
    if (inClass == "character") 
      dtrain <- xgb.DMatrix(data) else if (inClass == "xgb.DMatrix") 
      dtrain <- data else stop("xgboost: Invalid input of data")
  }
  
  if (verbose > 1) {
    silent <- 0 
  } else {
    silent <- 1
  }
  
  params <- append(params, list(silent = silent))
  params <- append(params, list(...))
  
  if (verbose > 0) 
    watchlist <- list(train = dtrain) else watchlist <- list()
  
  bst <- xgb.train(params, dtrain, nrounds, watchlist)
  
  return(bst)
} 
