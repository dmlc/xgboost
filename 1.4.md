## v1.4.0 (2021.04.11)

### Prediction
We overhauled the underlying prediction functions for C API and Python API with an unified
interface.  XGBoost has many prediction types including shap value computation and inplace
prediction.  Starting with 1.4, sklearn interface prediction will use inplace predict by
default when input data is supported.  Users can use inplace predict with ``dart`` booster
and enable GPU acceleration.  Also all prediction functions with tree model are now thread
safe.  Inplace predict is improved with ``base_margin`` support.  A new set of C predict
functions are exposed in public interface.

a7083d3c Fix dart inplace prediction with GPU input. (#6777)
e8c5c53e Use `Predictor` for `dart`. (#6693)
411592a3 Enhance inplace prediction. (#6653)
a9ec0ea6 Align device id in predict transform with predictor. (#6662)
c3c8e66f Make prediction functions thread safe. (#6648)
4656b09d [breaking] Add prediction fucntion for DMatrix and use inplace predict for dask. (#6668)


### Dask
Starting with 1.4, dask interface is considered to be feature complete, which means most
of the models found in single node Python interface are now supported in dask, including
but not limited to ranking and random forest.  Also the prediction function is
significantly faster.  Besides from that, shap value computation is also supported in dask
interface.

325bc93e [dask] Use `distributed.MultiLock` (#6743)
0ffaf0f5 Fix dask ip resolution. (#6475)
a30461cf [dask] Support all parameters in regressor and classifier. (#6471)
afc45672 [doc] [dask] fix partitioning in Dask example (#6389)
1e2c3ade [doc] [dask] Add example on early stopping with Dask (#6501)
d45c0d84 Show partition status in dask error. (#6366)
cd082150 Add Saturn Cloud Dask XGBoost tutorial to Awesome XGBoost [skip ci] (#6532)
de8fd852 [dask] Add type hints. (#6519)
96d3d322 [dask] Add shap tests. (#6575)
80065d57 [dask] Add DaskXGBRanker (#6576)
dc97b5f1 [dask] remove outdated comment (#6699)
89a00a58 [dask] Random forest estimators (#6602)
87ab1ad6 [dask] Accept `Future` of model for prediction. (#6650)
72892cc8 [dask] Disable gblinear and dart. (#6665)
b6167cd2 [dask] Use client to persist collections (#6722)
1335db61 [dask] Improve documents. (#6687)
d8ec7aad [dask] Add a 1 line sample to infer output shape. (#6645)
d167892c [dask] Ensure model can be pickled. (#6651)
7bc56fa0 Use simple print in tracker print function. (#6609)

### Python package
With changes from dask and general prediction improvement on prediction, we have made some
improvements on the general interface and booster information IO.  Starting from 1.4,
booster feature names and types can be saved into JSON model.  Also some model attributes
like ``best_iteration``, ``best_score`` are restored upon loading model.  Also on sklearn
interface some attributes are now implemented as Python object property with better documents.


47b86180 Don't validate feature when number of rows is 0. (#6472)
3c3f026e Move metric configuration into booster. (#6504) <!-- FIX -->
125b3c0f Lazy import cuDF and Dask (#6522)
ca3da55d Support early stopping with training continuation, correct num boosted rounds. (#6506)
610ee632 [Breaking] Rename `data` to `X` in `predict_proba`. (#6555)
fa139922 Calling XGBModel.fit() should clear the Booster by default (#6562)
195a41ce [python-package] remove unnecessary files to reduce sdist size (fixes #6560) (#6565)
f5ff90cd Support `_estimator_type`. (#6582)
60cfd143 [dask, sklearn] Fix predict proba. (#6566) <!-- FIX -->
872e559b Use inplace predict for sklearn. (#6718)
d356b7a0 Restore unknown data support. (#6595)
a9b4a952 Fix learning rate scheduler with cv. (#6720)
0027220a [breaking] Remove duplicated predict functions, Fix attributes IO. (#6593) <!-- FIX -->
26982f9f Skip unused CMake argument in setup.py (#6611)
9b267a43 Bail out early if libxgboost exists in python setup (#6694)
25077564 Fixes small typo in sklearn documentation (#6717)
4c5d2608 [python-package] Fix class Booster: feature_types = None (#6705)
a4101de6 Fix divide by 0 in feature importance when no split is found. (#6676) <!-- FIX -->
740d0422 Add base_margin for evaluation dataset. (#6591)
4bf23c23 Specify shape in prediction contrib and interaction. (#6614)
8942c980 Define metainfo and other parameters for all DMatrix interfaces. (#6601)


### JVM package
49c22c23 [jvm-packages] fix early stopping doesn't work even without custom_eval setting (#6738)
9d2832a3 fix potential TaskFailedListener's callback won't be called (#6612)
17913713 [jvm] Add ability to load booster direct from byte array (#6655)
fec66d03 [jvm-packages] JVM library loader extensions (#6630)

### R package
0c85b906 [R] Fix R package installation via CMake (#6423)
c2b6b806 R documentation: Make construction of DMatrix consistent.
4e00737c Fix R documentation for xgb.train. (#6764)

### ROC-AUC
We re-implemented the ROC-AUC metric in XGBoost.  The new implementation supports
multi-class classification and better support for learning to rank task.  Also it has a
better-defined average on distributed environment with additional handling for invalid
dataset.

1a73a285 Add device argsort. (#6749)
bcc02773 Re-implement ROC-AUC. (#6747)

### New features
fb56da5e Add global configuration (#6414)
366f3cb9 Add use_rmm flag to global configuration (#6656)
4f70e140 Fix docstring of config.py to use correct versionadded (#6458)
886486a5 Support categorical data in GPU weighted sketching. (#6508)
347f5931 Accept numpy array for DMatrix slice index. (#6368)
b0036b33 Optionaly fail when gpu_id is set to invalid value (#6342)

Array interface handling now supports arbitrary strides in input arrays.  Both GPU inputs
and CPU CSR matrix uses array interface for XGBoost's consumption.

794fd6a4 Support v3 cuda array interface. (#6776)
4ee8340e Support column major array. (#6765)
c103ec51 Enforce row-major order in cuPy array (#6459)

f6fe15d1 Improve parameter validation (#6769)
fbb980d9 Expand `~` into the home directory on Linux and MacOS (#6531) <!-- Python and R -->
9da2287a [breaking] Save booster feature info in JSON, remove feature name generation. (#6605)
dbb5208a Use __array_interface__ for creating DMatrix from CSR. (#6675)

### Changes
c5876277 Drop saving binary format for memory snapshot. (#6513)
0f2ed21a [Breaking] Change default evaluation metric for binary:logitraw objective to logloss (#6647)


### Notable fixes
8825670c Memory consumption fix for row-major adapters (#6779)
d231e7c3 [back port] Don't estimate sketch batch size when rmm is used. (#6807) (#6830)
a59c7323 Fix inplace predict missing value. (#6787)

1d905778 Verify strictly positive labels for gamma regression. (#6778)
2231940d Clip small positive values in gamma-nloglik (#6537)
23b4165a Fix gamma deviance (#6761)

4f75f514 Fix GPU RF (#6755)
4230dcb6 Re-introduce double buffer in UpdatePosition, to fix perf regression in gpu_hist (#6757)
c31e3efa Pass correct split_type to GPU predictor (#6491)
ef4a0e0a Fix DMatrix feature names/types IO. (#6507)
f2f7dd87 Use view for `SparsePage` exclusively. (#6590)
f20074e8 Check for invalid data. (#6742)
9c852343 fix relocatable include in CMakeList (#6734) (#6737)
5d48d40d Fix DMatrix slice with feature types. (#6689)

### Doc
642336ad [doc] Add FLAML as a fast tuning tool for XGBoost  (#6770)
e2d8a994 Add document for tests directory. [skip ci] (#6760)
5c87c2bb Update demo for prediction. (#6789)
55bdf084 [Doc] Document that AUC and AUCPR are for binary classification/ranking [skip ci] (#5899) <!-- merge with roc -->
749364f2 Update the C API comments (#6457)
2b049b32 Document various tree methods. (#6564)
9d62b145 Fix document. [skip ci] (#6669)
56180920 Fix document for tree methods. (#6633)


### Maintenance and CI
604ae01b [back port] Use CPU input for test_boost_from_prediction. (#6818) (#6824)
744c4699 [CI] Upload xgboost4j.dll to S3 (#6781)
e4894111 Update dmlc-core submodule (#6745)
b8044e61 [CI] Use manylinux2010_x86_64 container to vendor libgomp (#6485)
9a194273 Add conda-forge badge (#6502)
0e97d97d Fix merge conflict. (#6512)
d8d68453 [CI] Split up main.yml, add mypy. (#6515)
bf6cfe3b [Breaking] Upgrade cuDF and RMM to 0.18 nightlies; require RMM 0.18+ for RMM plugin (#6510)
95cbfad9 "featue_map" typo changed to  "feature_map" (#6540)
cb207a35 Add script for generating release tarball. (#6544)
8ad22bf4 Add credentials to .gitignore (#6559)
5e9e5252 Remove warnings in tests. (#6554)
b2246ae7 Update dmlc-core submodule and conform to new API (#6431)
78f2cd83 Suppress hypothesis health check for dask client. (#6589)
bdedaab8 Fix pylint. (#6714)
5ae7f994 [CI] Clear R package cache (#6746)
f8bb678c Exclude dmlc test on github action. (#6625)
1fa6793a Tests for regression metrics with weights. (#6729)
f0fd7629 Add helper script and doc for releasing pip package. (#6613)
c375173d Support pylint 2.7.0 (#6726)
9b530e56 Improve OpenMP exception handling (#6680)
dbf7e9d3 Remove R cache in github action. (#6695)
218a5fb6 Simplify Span checks. (#6685)
1e949110 Use generic dispatching routine for array interface. (#6672)
0ad6e18a [CI] Do not mix up stashed executable built for ARM and x86_64 platforms (#6646)
55ee2bd7 [CI] Add ARM64 test to Jenkins pipeline (#6643)
8968ca7c Disable s390x and arm64 tests on travis for now. (#6641)
d19a0dda Move sdist test to action. (#6635)
bc08e0c9 Remove `experimental_json_serialization` from tests. (#6640)
1b70a323 Improve string view to reduce string allocation. (#6644)
a275f402 [dask] Rework base margin test. (#6627)


### Optimization
19a2c542 Prediction by indices (subsample < 1) (#6683)
5c8ccf44 Improved InitSampling function speed by 2.12 times (#6410)
7f4d3a91 Multiclass prediction caching for CPU Hist (#6550)
9f15b9e3 Optimize CPU prediction (#6696)
9a0399e8 Removed unnecessary PredictBatch calls  (#6700)
